<!-- WORKSHOPS INDEX -->

<div class="index-ws-container">

  <button id="mapButton" class="index-ws-map-and-list-button">
    <span>Carte</span>
    <i class="fas fa-map-marked-alt"></i>
  </button>
  <button id="listButton" class="index-ws-map-and-list-button inactive">
    <span>Liste</span>
    <i class="fas fa-list-ul"></i>
  </button>

  <!-- WORKSHOPS INDEX SEARCH & FILTERS -->

  <div class="index-ws-search-filters-container">
    <div>
      <h2 id="index-ws-your-query">Votre recherche</h2>

      <div class="ws-index-search-parameters">
        <% if params[:search][:keyword].present? || params[:search][:place].present? %>

          <% if params[:search][:keyword].present? && params[:search][:place].present? %>
            <h3>atelier <%= params[:search][:keyword].downcase %></h3>
            <h4>à <%= params[:search][:place].capitalize %></h4>
          <% elsif params[:search][:keyword].present? %>
            <h3>atelier <%= params[:search][:keyword].downcase %></h3>
            <h4>toutes villes</h4>
          <% else %>
            <h3>atelier toutes thématiques</h3>
            <h4>à <%= params[:search][:place].capitalize %></h4>
          <% end %>
        <% else %>
          <h3>atelier toutes thématiques</h3>
          <h4>toutes villes</h4>
        <% end %>

        <% if params[:search][:starts_at].present? || params[:search][:ends_at].present? %>
          <h4>
            <% if params[:search][:starts_at].present? && params[:search][:ends_at].present? %>
              du <%= Date.strptime(params[:search][:starts_at], '%Y-%m-%d').strftime('%d/%m/%Y') %>
              au <%= Date.strptime(params[:search][:ends_at], '%Y-%m-%d').strftime('%d/%m/%Y') %>
            <% elsif params[:search][:starts_at].present? %>
              à partir du <%= Date.strptime(params[:search][:starts_at], '%Y-%m-%d').strftime('%d/%m/%Y') %>
            <% else %>
              jusqu'au <%= Date.strptime(params[:search][:ends_at], '%Y-%m-%d').strftime('%d/%m/%Y') %>
            <% end %>
          </h4>
        <% else %>
          <h4>à tout moment</h4>
        <% end %>

        <% if params[:search][:min_price].present? || params[:search][:max_price].present? %>
          <h4>
            <% if params[:search][:min_price].to_i != 0 %>
              min. <%= params[:search][:min_price].to_i %> €
            <% end %>
            <% if params[:search][:max_price].to_i != 0 %>
              max. <%= params[:search][:max_price].to_i %> €
            <% end %>
          </h4>
        <% end %>

        <% if params[:search][:ephemeral].present? %>
          <h4>
            <% if params[:search][:ephemeral] == 'false' %>
              permanent
            <% else %>
              éphémère ou permanent
            <% end %>
          </h4>
        <% end %>

      </div>
    </div>
    <div>
      <a href="#filtersModal" id="orderAndFilter" data-toggle="modal" data-whatever="@mdo">Filtrer</a>
      <%= render 'filters_modal' %>
    </div>
  </div>


  <!-- WORKSHOPS INDEX CARDS RESULTS -->
  <div class= "index-ws-cards-map-container">
    <div class="index-ws-left-side">
      <% if @workshops %>
        <% if @workshops.count > 1 %>
          <h1>Nous avons trouvé <span id="index-ws-title-strong"><%= @workshops.count %> ateliers créatifs</span> correspondant à votre recherche</h1>
        <% elsif @workshops.count == 1 %>
          <h1>Nous avons trouvé <span id="index-ws-title-strong"><%= @workshops.count %> atelier créatif</span> correspondant à votre recherche</h1>
        <% else %>
          <h1>Nous n'avons trouvé aucun atelier créatif correspondant à votre recherche</h1>
        <% end %>

        <div class= "index-ws-cards">
          <% @workshops.each do |workshop| %>

            <div class="ws-card" id="index-ws-card">
              <%= link_to(workshop, data: { turbolinks: false }) do  %>
                <div class="ws-card-image-and-rating" id="index-ws-card-image-and-rating">
                  <div class="ws-card-tags" id="index-ws-card-tags">
                    <% if workshop.rating %>
                      <div class="ws-card-tag ws-card-rating" id="index-ws-card-rating">
                        <i class="fas fa-star"></i><span><%= workshop.rating %></span>
                      </div>
                    <% end %>
                    <% if workshop.place.ephemeral == true %>
                      <div class="ws-card-tag ws-card-ephemeral" id="index-ws-card-ephemeral">
                        <span>éphémère</span>
                      </div>
                    <% end %>
                  </div>
                  <%= render "ws-index-carousel", workshop: workshop %>
                </div>
              <% end %>
              <%= link_to(workshop, data: { turbolinks: false }) do  %>
                <div class="ws-card-infos" id="index-ws-card-infos">
                  <div>
                    <div class="ws-card-place" id="index-ws-card-place-desktop">
                      <% if workshop.place.name.size > 19 %>
                        <h3><%= workshop.place.name[0..17] %>...</h3>
                      <% else %>
                        <h3><%= workshop.place.name %></h3>
                      <% end %>
                    </div>
                    <div class="ws-card-place" id="index-ws-card-place-mobile">
                      <% if workshop.place.name.size > 17 %>
                        <h3><%= workshop.place.name[0..16] %>...</h3>
                      <% else %>
                        <h3><%= workshop.place.name %></h3>
                      <% end %>
                    </div>
                    <div class="ws-card-title" id="index-ws-card-title">
                      <% if workshop.title.size > 33 %>
                        <h2><%= workshop.title[0..31] %>...</h2>
                      <% else %>
                        <h2><%= workshop.title %></h2>
                      <% end %>
                    </div>
                  </div>
                  <div class="ws-card-price-and-city" id="index-ws-card-price-and-city">
                    <div class="ws-card-price" id="index-ws-card-price">
                      <%= workshop.price %> €
                    </div>
                    <div class="ws-card-city" id="index-ws-card-city">
                      <i class="fas fa-map-marker-alt"></i>
                      <% if workshop.place.city.size >= 11 %>
                        <span id="city-name"><%= workshop.place.city[0..11].capitalize %>...</span>
                      <% else %>
                        <span id="city-name"><%= workshop.place.city.capitalize %></span>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>

        </div>

      <% else %>
        <div class="index-ws-no-result">
          Nous n'avons pas trouvé de résultat pour votre recherche...
        </div>
      <% end %>
    </div>
    <div id="map" class="ws-map"
             style="width: 100%; height: 100vh; top: 0;"
             data-markers="<%= @markers.to_json %>"
             data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
  </div>

</div>
