<% if @workshop %>

  <% content_for :meta_title, "Jeu de Mains | Finalisation création d'atelier" %>

  <!-- NEW WORKSHOP FORM -->

  <div class="dashboard-title-container" id="dashboard-organizer-title-container">
    <h1>
      <span>Finalisez la création de votre atelier !</span>
    </h1>
  </div>

  <div class="new-ws-container">
    <div class="accordion" id="accordionNewWsTwo">

      <!-- FIRST SESSION -->

      <div class="card">
        <div class="card-header card-header-1" data-toggle="collapse" data-target="#collapse-1" aria-expanded="true">
          <span class="title">Ajoutez une première date</span>
          <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
        </div>
        <div id="collapse-1" class="collapse collapse-1 show" data-parent="#accordionNewWsTwo">
          <div class="card-body">
            <strong>Ouvrez la réservation avec une première date d'atelier &#128521;</strong><br>
            Vous n'avez pas encore rempli tous les champs de votre atelier ou ne connaissez pas la première date ? <br>
            Vous pouvez trouver vos ateliers “en ligne” et “hors ligne” dans votre <strong><%= link_to "tableau de bord", tableau_de_bord_profile_path(current_user.profile) %></strong>.
            <br><br>

            <% if @workshop.sessions.present? %>
              <div class="session_success">
                <p>Votre première date a bien été ajoutée :</p>
                <p><%= l(@workshop.sessions.last.date, format: '%A %d %b %Y').capitalize %> à <%=@workshop.sessions.last.start_at%> - capacité : <%= @workshop.sessions.last.capacity %> place(s)</p>
              </div>
            <% else %>
              <div class="session_form_container">
                <%= simple_form_for([@workshop, @session]) do |f| %>
                  <%= f.input :date, label: "Première date d'atelier" %>
                  <%= f.input :start_at, label: "Heure de début", collection: Session::STARTS_AT %>
                  <%= f.input :capacity, label: "Nombre de places si différent de celui indiqué dans la fiche atelier (sinon laisser vide)" %>

                  <%= f.submit 'Ajouter', class: "button" %>
                <% end %>
              </div>
            <% end %>


            <div class="next-previous">
              <a class="next-previous-button btnNext" id="next-1" >Suivant</a>
            </div>
          </div>
        </div>
      </div>

      <!-- ANIMATORS -->

      <div class="card">
        <div class="card-header card-header-2 collapsed" data-toggle="collapse" data-target="#collapse-2" aria-expanded="false" aria-controls="collapse-2">
          <span class="title">Animateur de votre atelier (optionnel)</span>
          <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
        </div>
        <div id="collapse-2" class="collapse collapse-2" data-parent="#accordionNewWsTwo">
          <div class="card-body">
            Jeu de Mains est un melting pot de partenaires boutiques, ateliers d'artisans, organisateurs d'événements et animateurs freelance. La plateforme n'est pas responsable des collaborations entre les partenaires mais tient à les mettre en avant et à créer des synergies entre les partenaires de la communauté. <br><br>
            <strong>Votre atelier sera animé par une entreprise ou un indépendant externe à votre société ?</strong><br>
            Sélectionnez-le dans le menu déroulant ci-dessous ou invitez-le à rejoindre la communauté jeudemains.com ! <br>
            <br>

            <div class='ws-finalisation-add-animator-forms'>
              <%= simple_form_for([@workshop, @animator]) do |f| %>
                <div class="form-group select required animator_user">
                  <label class="select required" for="animator_user_id">L'atelier est animé par :</label>
                  <select class="form-control select required" name="animator[user_id]" id="animator_user_id">
                    <% if @workshop.animators.where(db_status: true).present? %>
                      <option value="<%= @workshop.animators.first.user.id %>" selected><%= @workshop.animators.where(db_status: true).first.user.profile.company %></option>
                      <option value="">----------------</option>
                    <% end %>
                    <% @users.sort_by { |user| user.profile.company }.each do |user| %>
                      <option value="<%= user.id %>"><%= user.profile.company %></option>
                    <% end %>
                  </select>
                </div>
                <%= f.hidden_field :creation, value: true %>
                <%= f.submit "Ajouter et continuer", class: "button" %>
              <% end %>

              <p>ou</p>

              <%= simple_form_for :invitation, url: invitation_workshop_path, method: :get do |f| %>
                <%= f.hidden_field :workshop_id, value: @workshop.id %>
                <%= f.input :email, required: false, label: "invitez l'animateur à rejoindre Jeu de Mains :", placeholder: "E-mail de l'animateur" %>
                <%= f.submit "Inviter et continuer", class: "button" %>
              <% end %>
            </div>
            <div class='d-flex align-items-center justify-content-end mt-5 mb-5'>
              <%= link_to "Continuer sans animateur", confirmation_workshop_path(@workshop), class: "new-edit-ws-submit" %>
            </div>

            <div class="next-previous">
              <a class="next-previous-button btnPrevious" id="previous-2" >Retour</a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<% end %>
