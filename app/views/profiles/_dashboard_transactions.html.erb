<p>tous les montants sont indiqués en euros TTC</p>
<p>Cliquez sur les titres de colonnes pour trier par ordre A-Z, Z-A ou croissant décroissant</p>

<%= link_to tableau_de_bord_profile_path(format: :xls) do %>
  Exporter .xls
  <i class="fas fa-upload ml-1"></i>
<% end %>

<div class="table-responsive" style="font-size: 13.5px; font-weight:500; font-family: helvetica, sans-serif;">
  <table class="table table-striped sortable">
    <thead>
      <tr style="background-color: #235B6A; color: #fff;">
        <th scope="col" style='cursor: pointer; font-weight: 500;vertical-align:top;'>Date</th>
        <th scope="col" style='cursor: pointer; font-weight: 500;vertical-align:top;'>Libellé</th>
        <th scope="col" style='cursor: pointer; font-weight: 500;vertical-align:top;'>Réservation n°</th>
        <th scope="col" style='cursor: pointer; font-weight: 500;vertical-align:top;'>Atelier</th>
        <th scope="col" style='cursor: pointer; font-weight: 500;vertical-align:top;'>Session</th>
        <th scope="col" style='cursor: pointer; font-weight: 500;vertical-align:top;'>Montant</th>
        <th scope="col" style='cursor: pointer; font-weight: 500;vertical-align:top;'>Commission JDM</th>
        <th scope="col" style='cursor: pointer; font-weight: 500;vertical-align:top;'>Votre recette</th>
        <th scope="col" style='cursor: pointer; font-weight: 500;vertical-align:top;'>Plus d'infos</th>
      </tr>
    </thead>
    <tbody>
      <% @transaction_bookings.reverse.each do |b| %>
        <tr>
          <td><%= b[:date].strftime('%d/%m/%y') %></td>
          <td><%= b[:label] %></td>
          <td><%= b[:booking_number] %></td>
          <td><%= link_to b[:workshop].title, workshop_path(b[:workshop]), target: "_blank" %></td>
          <td><%= link_to "#{b[:session].date.strftime("%d/%m/%y")} à #{b[:session].start_at}", session_participants_path(b[:session]), target: "_blank" %></td>
          <% if b[:status] == "success" %>
            <td style="text-align:right;"><%= b[:amount].to_s.gsub(".",",") %></td>
            <td style="text-align:right;">- <%= (b[:amount] * b[:fee_rate]).round(2).to_s.gsub(".",",") %></td>
            <td style="text-align:right;"><%= (b[:amount] * (1 - b[:fee_rate])).round(2).to_s.gsub(".",",") %></td>
          <% else %>
            <% cancel_fee = b[:amount] * (1.0 - b[:refund_rate]) %>
            <td style="text-align:right;">- <%=((b[:amount] * b[:refund_rate]).round(2)).to_s.gsub(".",",") %></td>
            <td style="text-align:right;"><%= ((b[:amount] - cancel_fee) * b[:fee_rate]).round(2).to_s.gsub(".",",") %></td>
            <td style="text-align:right;">- <%= ((b[:amount] - cancel_fee) * (1 - b[:fee_rate])).round(2).to_s.gsub(".",",") %></td>
          <% end %>
          <td style='padding-left:7px;'><%= link_to "Plus d'infos" , booking_path(b[:booking])  %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

